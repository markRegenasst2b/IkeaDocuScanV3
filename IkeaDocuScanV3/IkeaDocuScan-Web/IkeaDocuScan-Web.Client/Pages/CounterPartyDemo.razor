@page "/counterparty-demo"
@rendermode InteractiveAuto
@attribute [Authorize(Policy = "HasAccess")]
@using IkeaDocuScan.Shared.DTOs.CounterParties
@using IkeaDocuScan_Web.Client.Components
@using IkeaDocuScan_Web.Client.Components.DocumentManagement
@using Microsoft.AspNetCore.Authorization

<PageTitle>Component Demo</PageTitle>

<div class="container mt-4">
    <h1>Reusable Components Demo</h1>
    <p class="text-muted">This page demonstrates how to use the reusable components.</p>

    <div class="card mt-4">
        <div class="card-header">
            <h5 class="mb-0">1. Country Select Component</h5>
        </div>
        <div class="card-body">
            <h6>Simple dropdown for country selection:</h6>
            <CountrySelect
                Label="Select Country"
                SelectedCountryCode="@selectedCountryCode"
                SelectedCountryCodeChanged="@OnCountrySelected"
                CssClass="mb-3" />

            @if (!string.IsNullOrEmpty(selectedCountryCode))
            {
                <div class="alert alert-success">
                    <strong>Selected Country Code:</strong> @selectedCountryCode
                </div>
            }
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h5 class="mb-0">2. Document Type Select Component</h5>
        </div>
        <div class="card-body">
            <h6>Simple dropdown for document type selection:</h6>
            <DocumentTypeSelect
                Label="Select Document Type"
                SelectedDocumentTypeId="@selectedDocumentTypeId"
                SelectedDocumentTypeIdChanged="@OnDocumentTypeSelected"
                CssClass="mb-3" />

            @if (selectedDocumentTypeId.HasValue)
            {
                <div class="alert alert-success">
                    <strong>Selected Document Type ID:</strong> @selectedDocumentTypeId.Value
                </div>
            }
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h5 class="mb-0">3. Counter Party Search Component</h5>
        </div>
        <div class="card-body">
            <h6>Modal dialog with auto-search as you type:</h6>
            <CounterPartySearch
                SelectedCounterParty="@selectedCounterParty"
                SelectedCounterPartyChanged="@OnCounterPartySelected"
                MinSearchLength="3" />

            @if (selectedCounterParty != null)
            {
                <div class="alert alert-success mt-4">
                    <h6>You selected:</h6>
                    <ul class="mb-0">
                        <li><strong>ID:</strong> @selectedCounterParty.CounterPartyId</li>
                        <li><strong>Number:</strong> @selectedCounterParty.CounterPartyNoAlpha</li>
                        <li><strong>Name:</strong> @selectedCounterParty.Name</li>
                        <li><strong>City:</strong> @selectedCounterParty.City</li>
                        <li><strong>Country:</strong> @selectedCounterParty.Country</li>
                        @if (!string.IsNullOrEmpty(selectedCounterParty.Address))
                        {
                            <li><strong>Address:</strong> @selectedCounterParty.Address</li>
                        }
                    </ul>
                </div>
            }
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h5 class="mb-0">4. Third Party Selector Component</h5>
        </div>
        <div class="card-body">
            <h6>Multi-select listboxes for associating multiple counter parties to a document:</h6>
            <ThirdPartySelector2 @bind-SelectedIds="selectedCounterPartyIds" />

            @if (!string.IsNullOrWhiteSpace(selectedCounterPartyIds))
            {
                <div class="alert alert-success mt-4">
                    <h6>Selected Counter Party IDs:</h6>
                    <p class="mb-0"><strong>@selectedCounterPartyIds</strong></p>
                    <small class="text-muted">
                        (Count: @(selectedCounterPartyIds.Split(';', StringSplitOptions.RemoveEmptyEntries).Length))
                    </small>
                </div>
            }
            else
            {
                <div class="alert alert-secondary mt-4">
                    <p class="mb-0">No counter parties selected yet.</p>
                </div>
            }
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h5 class="mb-0">How to Use</h5>
        </div>
        <div class="card-body">
            <h6>Country Select Component:</h6>
            <pre class="bg-light p-3"><code>@@using IkeaDocuScan_Web.Client.Components

&lt;CountrySelect
    Label="Select Country"
    SelectedCountryCode="@@selectedCountryCode"
    SelectedCountryCodeChanged="@@OnCountrySelected"
    CssClass="mb-3" /&gt;

@@code {
    private string? selectedCountryCode;

    private void OnCountrySelected(string? countryCode)
    {
        selectedCountryCode = countryCode;
    }
}</code></pre>

            <h6 class="mt-4">Country Select Features:</h6>
            <ul>
                <li>Simple dropdown with all countries</li>
                <li>Displays Name and Code (e.g., "Sweden (SE)")</li>
                <li>Optional label parameter</li>
                <li>Optional CSS class parameter</li>
                <li>Can be disabled with Disabled parameter</li>
                <li>Two-way binding with SelectedCountryCode</li>
            </ul>

            <hr class="my-4" />

            <h6>Document Type Select Component:</h6>
            <pre class="bg-light p-3"><code>@@using IkeaDocuScan_Web.Client.Components

&lt;DocumentTypeSelect
    Label="Select Document Type"
    SelectedDocumentTypeId="@@selectedDocumentTypeId"
    SelectedDocumentTypeIdChanged="@@OnDocumentTypeSelected"
    CssClass="mb-3" /&gt;

@@code {
    private int? selectedDocumentTypeId;

    private void OnDocumentTypeSelected(int? documentTypeId)
    {
        selectedDocumentTypeId = documentTypeId;
    }
}</code></pre>

            <h6 class="mt-4">Document Type Select Features:</h6>
            <ul>
                <li>Simple dropdown with all enabled document types</li>
                <li>Displays document type name</li>
                <li>Optional label parameter</li>
                <li>Optional CSS class parameter</li>
                <li>Can be disabled with Disabled parameter</li>
                <li>Two-way binding with SelectedDocumentTypeId</li>
                <li>Automatically filters to show only enabled document types</li>
            </ul>

            <hr class="my-4" />

            <h6>Counter Party Search Component:</h6>
            <pre class="bg-light p-3"><code>@@using IkeaDocuScan.Shared.DTOs.CounterParties
@@using IkeaDocuScan_Web.Client.Components

&lt;CounterPartySearch
    SelectedCounterParty="@@selectedCounterParty"
    SelectedCounterPartyChanged="@@OnCounterPartySelected"
    MinSearchLength="3" /&gt;

@@code {
    private CounterPartyDto? selectedCounterParty;

    private void OnCounterPartySelected(CounterPartyDto counterParty)
    {
        selectedCounterParty = counterParty;
    }
}</code></pre>

            <h6 class="mt-4">Counter Party Search Features:</h6>
            <ul>
                <li>Search by Name, CounterPartyNoAlpha, City, or Country</li>
                <li><strong>Auto-search as you type</strong> (500ms debounce delay)</li>
                <li><strong>Configurable minimum search length</strong> (MinSearchLength parameter, default: 3)</li>
                <li>Visual feedback when typing (shows minimum character requirement)</li>
                <li>Results displayed in a modal dialog</li>
                <li>Shows CounterPartyNoAlpha and Name when selected</li>
                <li>Two-way binding with SelectedCounterParty parameter</li>
                <li>Press Enter for immediate search (bypasses debounce)</li>
                <li>Manual search button still available</li>
                <li>Results limited to 100 for performance</li>
            </ul>

            <hr class="my-4" />

            <h6>Third Party Selector Component:</h6>
            <pre class="bg-light p-3"><code>@@using IkeaDocuScan_Web.Client.Components

&lt;ThirdPartySelector @@bind-SelectedIds="selectedCounterPartyIds" /&gt;

@@code {
    private string selectedCounterPartyIds = ""; // Or initialize with existing IDs: "1;5;12"

    private async Task SaveDocument()
    {
        // Use selectedCounterPartyIds when saving
        // It will be a semicolon-separated string like "1;5;12"
    }
}</code></pre>

            <h6 class="mt-4">Third Party Selector Features:</h6>
            <ul>
                <li>Two listboxes: Available (top) and Selected (bottom)</li>
                <li>Only shows counter parties with <strong>DisplayAtCheckIn = true</strong></li>
                <li>Add and Remove buttons to move items between lists</li>
                <li>Single-select mode (click to select, then click button to move)</li>
                <li>Persists selections as semicolon-separated IDs (e.g., "1;5;12")</li>
                <li>Two-way binding with SelectedIds parameter</li>
                <li>Automatically initializes from existing ID string</li>
                <li>Responsive layout using Bootstrap grid</li>
                <li>Displays counter party names only (clean, simple display)</li>
                <li>Shows count of selected counter parties</li>
            </ul>
        </div>
    </div>
</div>

@code {
    private string? selectedCountryCode;
    private int? selectedDocumentTypeId;
    private CounterPartyDto? selectedCounterParty;
    private string selectedCounterPartyIds = ""; // For ThirdPartySelector

    private void OnCountrySelected(string? countryCode)
    {
        selectedCountryCode = countryCode;
    }

    private void OnDocumentTypeSelected(int? documentTypeId)
    {
        selectedDocumentTypeId = documentTypeId;
    }

    private void OnCounterPartySelected(CounterPartyDto counterParty)
    {
        selectedCounterParty = counterParty;
    }
}
