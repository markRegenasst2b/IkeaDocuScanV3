@using IkeaDocuScan_Web.Client.Services
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.Web
@using System.Security.Claims
@namespace IkeaDocuScan_Web.Client.Layout
@rendermode @(new InteractiveWebAssemblyRenderMode(prerender: false))
@inject UserIdentityHttpService UserIdentityHttpService

<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">Ikea Documentscannning</a>
    </div>
</div>

<input type="checkbox" title="Navigation menu" class="navbar-toggler" />

<div class="nav-scrollable" onclick="document.querySelector('.navbar-toggler').click()">
    

    <nav class="nav flex-column">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> Home
            </NavLink>
        </div>

        <AuthorizeView Policy="HasAccess">
            <Authorized>
                <div class="nav-section-header">DOCUMENT MANAGEMENT</div>

@* Register Document - Show for Publisher role OR SuperUser *@
                @if (canCreateEdit)
                {
                    <div class="nav-item px-3">
                        <NavLink class="nav-link" href="documents/register">
                            <span class="bi bi-file-earmark-plus" aria-hidden="true"></span> Register Document
                        </NavLink>
                    </div>
                }

                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="documents/search">
                        <span class="bi bi-search" aria-hidden="true"></span> Search Documents
                    </NavLink>
                </div>

@* Check-in Scanned - Show for Publisher role OR SuperUser *@
                @if (canCreateEdit)
                {
                    <div class="nav-item px-3">
                        <NavLink class="nav-link" href="checkin-scanned">
                            <span class="bi bi-folder-nav-menu" aria-hidden="true"></span> Check-in Scanned
                        </NavLink>
                    </div>
                }

@* Action Reminders - Show for Publisher role OR SuperUser *@
                @if (canCreateEdit)
                {
                    <div class="nav-item px-3">
                        <NavLink class="nav-link" href="action-reminders">
                            <span class="bi bi-calendar-check" aria-hidden="true"></span> Action Reminders
                        </NavLink>
                    </div>
                }

                <div class="nav-section-header">SPECIAL REPORTS</div>

                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="excel-preview?reportType=barcode-gaps">
                        <span class="bi bi-bar-chart" aria-hidden="true"></span> Barcode Gaps
                    </NavLink>
                </div>
@* *@
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="excel-preview?reportType=duplicate-documents">
                        <span class="bi bi-files" aria-hidden="true"></span> Duplicate Documents
                    </NavLink>
                </div>
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="excel-preview?reportType=unlinked-registrations">
                        <span class="bi bi-link-45deg" aria-hidden="true"></span> Unlinked Registrations
                    </NavLink>
                </div>
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="excel-preview?reportType=scan-copies">
                        <span class="bi bi-file-earmark-image" aria-hidden="true"></span> Scan Copies
                    </NavLink>
                </div>

                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="excel-preview?reportType=suppliers">
                        <span class="bi bi-building" aria-hidden="true"></span> Suppliers
                    </NavLink>
                </div>
@* *@
@* 
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="excel-preview?reportType=all-documents">
                        <span class="bi bi-file-earmark-text" aria-hidden="true"></span> All Documents
                    </NavLink>
                </div>

 *@
                @* ADMINISTRATION - Show section header only if user has access to any admin item *@
                <AuthorizeView Policy="SuperUser">
                    <Authorized Context="superUserContext">
                        <div class="nav-section-header">ADMINISTRATION</div>

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="edit-userpermissions">
                                <span class="bi bi-people-nav-menu" aria-hidden="true"></span> User Permissions
                            </NavLink>
                        </div>

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="currency-administration">
                                <span class="bi bi-currency-dollar" aria-hidden="true"></span> Currency
                            </NavLink>
                        </div>

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="country-administration">
                                <span class="bi bi-globe" aria-hidden="true"></span> Country
                            </NavLink>
                        </div>

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="documenttype-administration">
                                <span class="bi bi-file-earmark-text" aria-hidden="true"></span> Document Type
                            </NavLink>
                        </div>

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="counterparty-administration">
                                <span class="bi bi-building" aria-hidden="true"></span> Counter Party
                            </NavLink>
                        </div>

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="manage-document-names">
                                <span class="bi bi-building" aria-hidden="true"></span> Document Names
                            </NavLink>
                        </div>

                        <div class="nav-section-header">SETTINGS</div>

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="configuration-management">
                                <span class="bi bi-gear" aria-hidden="true"></span> Configuration
                            </NavLink>
                        </div>

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="audit-trail">
                                <span class="bi bi-shield-check" aria-hidden="true"></span> Audit Trail
                            </NavLink>
                        </div>

                        <div class="nav-item px-3">
                            <NavLink class="nav-link" href="admin/logs">
                                <span class="bi bi-file-text" aria-hidden="true"></span> System Logs
                            </NavLink>
                        </div>
                    </Authorized>
                </AuthorizeView>

             </Authorized>
        </AuthorizeView>

        <!--
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="weather">
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> Weather
            </NavLink>
        </div>
        -->
    </nav>
</div>

@code {
    private bool canCreateEdit = false;

    protected override async Task OnInitializedAsync()
    {
        var user = await UserIdentityHttpService.GetUserIdentityAsync();

        var claims = user.Claims;
        // Type = 'http://schemas.microsoft.com/ws/2008/06/identity/claims/role' 'SuperUser'
        //        'IsSuperUser' 'True'
        // Check if user has Publisher role OR SuperUser policy (IsSuperUser claim)
        var isPublisher = claims.Any(c => c.Type == "http://schemas.microsoft.com/ws/2008/06/identity/claims/role" && c.Value == "Publisher");
        var isSuperUser = claims.Any(c => (c.Type == "http://schemas.microsoft.com/ws/2008/06/identity/claims/role" && c.Value == "SuperUser") 
                                       || (c.Type == "IsSuperUser" && c.Value == "True"));

        canCreateEdit = isPublisher || isSuperUser;
    }
}
